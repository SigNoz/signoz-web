---
date: 2025-08-19
title: K8s Serverless (EKS Fargate) - Install
id: install
---

Use this guide to deploy an OpenTelemetry Collector sidecar alongside your applications on EKS Fargate. The sidecar receives OTLP telemetry from your app and forwards it to SigNoz. It runs within your pod and requires no node-level access.

## Prerequisites

- An EKS cluster with Fargate profiles configured
- A SigNoz backend (SigNoz Cloud or self-hosted)
- kubectl access to update your app `Deployment`/`Pod` specs
- A Kubernetes ServiceAccount mapped to your workloads with sufficient RBAC


## 1. Create a ConfigMap for the sidecar collector

Create a ConfigMap containing the collector configuration:

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: otel-agent-sidecar-config
  namespace: <YOUR_NAMESPACE>
data:
  otel-agent-config.yaml: |
    exporters:
      debug:
        sampling_initial: 2
        sampling_thereafter: 500
        verbosity: basic
      otlp:
        endpoint: ${env:OTEL_EXPORTER_OTLP_ENDPOINT}
        headers:
          signoz-access-token: ${env:SIGNOZ_API_KEY}
        tls:
          insecure: ${env:OTEL_EXPORTER_OTLP_INSECURE}
          insecure_skip_verify: ${env:OTEL_EXPORTER_OTLP_INSECURE_SKIP_VERIFY}
    extensions:
      health_check:
        endpoint: 0.0.0.0:13133
      pprof:
        endpoint: localhost:1777
      zpages:
        endpoint: localhost:55679
    processors:
      batch:
        send_batch_size: 10000
        timeout: 200ms
      k8sattributes:
        extract:
          annotations: []
          labels: []
          metadata:
          - k8s.namespace.name
          - k8s.deployment.name
          - k8s.statefulset.name
          - k8s.daemonset.name
          - k8s.cronjob.name
          - k8s.job.name
          - k8s.node.name
          - k8s.node.uid
          - k8s.pod.name
          - k8s.pod.uid
          - k8s.pod.start_time
        filter:
          node_from_env_var: K8S_NODE_NAME
        passthrough: false
        pod_association:
        - sources:
          - from: resource_attribute
            name: k8s.pod.ip
        - sources:
          - from: resource_attribute
            name: k8s.pod.uid
        - sources:
          - from: connection
      resourcedetection:
        detectors:
        - eks
        - k8snode
        - env
        - system
        k8snode:
          auth_type: serviceAccount
          node_from_env_var: K8S_NODE_NAME
        override: false
        system:
          resource_attributes:
            host.id:
              enabled: false
            host.name:
              enabled: false
            os.type:
              enabled: true
        timeout: 2s
    receivers:
      kubeletstats:
        auth_type: serviceAccount
        collection_interval: 30s
        endpoint: ${env:K8S_HOST_IP}:10250
        extra_metadata_labels:
        - container.id
        - k8s.volume.type
        insecure_skip_verify: true
        metric_groups:
        - container
        - pod
        - node
        - volume
        metrics:
          container.cpu.usage:
            enabled: true
          container.uptime:
            enabled: true
          k8s.container.cpu_limit_utilization:
            enabled: true
          k8s.container.cpu_request_utilization:
            enabled: true
          k8s.container.memory_limit_utilization:
            enabled: true
          k8s.container.memory_request_utilization:
            enabled: true
          k8s.node.cpu.usage:
            enabled: true
          k8s.node.uptime:
            enabled: true
          k8s.pod.cpu.usage:
            enabled: true
          k8s.pod.cpu_limit_utilization:
            enabled: true
          k8s.pod.cpu_request_utilization:
            enabled: true
          k8s.pod.memory_limit_utilization:
            enabled: true
          k8s.pod.memory_request_utilization:
            enabled: true
          k8s.pod.uptime:
            enabled: true
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
            max_recv_msg_size_mib: 4
          http:
            endpoint: 0.0.0.0:4318
    service:
      extensions:
      - health_check
      - zpages
      - pprof
      pipelines:
        logs:
          exporters:
          - debug
          - otlp
          processors:
          - resourcedetection
          - k8sattributes
          - batch
          receivers:
          - otlp
        metrics:
          exporters:
          - otlp
          - debug
          processors:
          - resourcedetection
          - k8sattributes
          - batch
          receivers:
          - otlp
          - kubeletstats
        traces:
          exporters:
          - otlp
          - debug
          processors:
          - resourcedetection
          - k8sattributes
          - batch
          receivers:
          - otlp
      telemetry:
        logs:
          encoding: json
        metrics:
          address: 0.0.0.0:8888
```

This configuration reads exporter endpoints and credentials from environment variables you set in your Deployment.

## 2. Cluster roles and privileges

Ensure the ServiceAccount used by your Deployments/Apps has the following permissions:

```yaml

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: otel-agent-sidecar-role
  namespace: fargate-instances
rules:
- apiGroups:
  - ""
  resources:
  - pods
  - namespaces
  - nodes
  - persistentvolumeclaims
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - replicasets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - extensions
  resources:
  - replicasets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - nodes
  - endpoints
  verbs:
  - list
  - watch
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - list
  - watch
- apiGroups: [""]
  resources:
    - nodes
    - nodes/proxy
    - nodes/metrics
    - services
    - endpoints
    - pods
    - pods/proxy
  verbs: ["get", "list", "watch"]
- nonResourceURLs: [ "/metrics/cadvisor"]
  verbs: ["get", "list", "watch"]

- apiGroups:
  - ""
  resources:
  - nodes/stats
  - configmaps
  - events
  verbs:
  - create
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: otel-agent-sidecar-binding
subjects:
- kind: ServiceAccount
  # Make sure the name and namespace match your Service Account
  name: otel-demo-fargate
  namespace: fargate-instances
roleRef:
  kind: ClusterRole
  name: otel-agent-sidecar-role
  apiGroup: rbac.authorization.k8s.io
```
## 3. Add the sidecar container to your app 

Add the following sidecar container to your Deployments/Apps. Replace placeholders such as `<OTLP_EXPORTER_OTLP_ENDPOINT>` and `<YOUR_K8S_CLUSTER_NAME>` with values for your environment.

## Sidecar configuration

```yaml
    additionalVolumes:
    - configMap:
        name: otel-agent-sidecar-config
      name: otel-agent-config-vol

    sidecarContainers:
    - name: opentelemetry-collector-contrib
      imageOverride:
          repository: otel/opentelemetry-collector-contrib
          tag: 0.109.0
      command:
        - /otelcol-contrib --config=/conf/otel-agent-config.yaml
      env:
        # This endpoint should be reachable from your pod
        - name: OTEL_EXPORTER_OTLP_ENDPOINT
          value: <OTLP_EXPORTER_OTLP_ENDPOINT>
        - name: OTEL_EXPORTER_OTLP_INSECURE
          value: "true"
        - name: OTEL_SECRETS_PATH
          value: /secrets
        - name: K8S_CLUSTER_NAME
          value: <YOUR_K8S_CLUSTER_NAME>
        - name: K8S_NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: K8S_POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: K8S_HOST_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: K8S_POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: K8S_POD_UID
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.uid
        - name: K8S_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: SIGNOZ_COMPONENT
          value: otel-agent
        - name: OTEL_RESOURCE_ATTRIBUTES
          value: signoz.component=$(SIGNOZ_COMPONENT),k8s.cluster.name=$(K8S_CLUSTER_NAME),k8s.node.name=$(K8S_NODE_NAME),host.name=$(K8S_NODE_NAME)
      livenessProbe:
        failureThreshold: 6
        httpGet:
          path: /
          port: 13133
          scheme: HTTP
        initialDelaySeconds: 10
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 5
      ports:
        - containerPort: 13133
          name: health-check
          protocol: TCP
        - containerPort: 8888
          name: metrics
          protocol: TCP
        - containerPort: 4317
          name: otlp
          protocol: TCP
        - containerPort: 4318
          name: otlp-http
          protocol: TCP
      readinessProbe:
        failureThreshold: 6
        httpGet:
          path: /
          port: 13133
          scheme: HTTP
        initialDelaySeconds: 10
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 5
      resources:
        requests:
          cpu: 100m
          memory: 100Mi
      useDefault:
        env: true
      volumeMounts:
        - mountPath: /conf
          name: otel-agent-config-vol
        - mountPath: /var/log
          name: varlog
          readOnly: true
```

## 4. Apply manifests

```bash
kubectl apply -f otel-agent-sidecar-config.yaml
kubectl apply -f app-deployment.yaml
```

## Next steps

- Read the [K8s Serverless (EKS Fargate) Overview](/docs/collection-agents/k8s/serverless/overview)

