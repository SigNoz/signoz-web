---
date: 2024-06-06
id: kubernetes-infra-metrics
title: Kubernetes Infra Metrics and Logs Collection
description: Learn how to view Kubernetes infrastructure metrics and logs in SigNoz. Enable and configure OpenTelemetry collectors for comprehensive observability.
hide_table_of_contents: true
---

import K8sMetrics from '@/components/shared/k8s-metrics-list.md'
import HostMetrics from '@/components/shared/hostmetrics-list.md'


### Overview

To export Kubernetes metrics, you can enable different receivers in OpenTelemetry
collector which will send metrics about your Kubernetes infrastructure
to SigNoz. These OpenTelemetry collectors will act as agents which send
metrics about Kubernetes to SigNoz.

OtelCollector agent can also be used to tail and parse logs generated by
container using `filelog` receiver and send it to desired receiver.

`K8s-Infra` helm chart mainly does the following:
- Tails and parses logs generated by containers in Kubernetes cluster and sends to SigNoz
- Collects kubelet metrics and host metrics from each nodes of the Kubernetes cluster
- Collects cluster-level metrics from the Kubernetes API server
- Acts as a gateway to send any incoming OTLP telemetry data to SigNoz OtelCollector

---

Based on how you are running SigNoz (e.g. SigNoz Cloud, in an independent VM or Kubernetes cluster),
you have to provide the address to send data from the above receivers.

<Tabs>
  <TabItem value="cloud" label="SigNoz Cloud" default>

### Install K8s-Infra chart

To add the SigNoz Helm repository to your helm client, run the following command:

```bash
helm repo add signoz https://charts.signoz.io
```

If the chart is already present, update the chart to the latest version:

```bash
helm repo update
```

<Tabs groupId="k8s-vendor">
  <TabItem value="generic" label="Generic" default>

    For generic Kubernetes clusters, you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: others
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: ingest.{region}.signoz.cloud:443
    otelInsecure: false
    signozApiKey: <SIGNOZ_INGESTION_KEY>
    ```

  </TabItem>
  <TabItem value="eks" label="AWS EKS">

    For AWS Elastic Kubernetes Service (EKS), you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: aws
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: ingest.{region}.signoz.cloud:443
    otelInsecure: false
    signozApiKey: <SIGNOZ_INGESTION_KEY>
    presets:
      resourceDetection:
        detectors:
          - aws
          - system
    ```

  </TabItem>
  <TabItem value="gke" label="GKE (Standard)">

    For Google Kubernetes Engine (GKE) Standard, you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: gcp
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: ingest.{region}.signoz.cloud:443
    otelInsecure: false
    signozApiKey: <SIGNOZ_INGESTION_KEY>
    presets:
      resourceDetection:
        detectors:
          - gcp
          - system
    ```

  </TabItem>
  <TabItem value="gke-autopilot" label="GKE (Autopilot)">

    For Google Kubernetes Engine (GKE) Autopilot, you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: gcp/autogke
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: ingest.{region}.signoz.cloud:443
    otelInsecure: false
    signozApiKey: <SIGNOZ_INGESTION_KEY>
    presets:
      kubeletMetrics:
        authType: none
        endpoint: ${K8S_NODE_NAME}:10255
      resourceDetection:
        detectors:
          - gcp
          - system
    ```

  </TabItem>
  <TabItem value="aks" label="AKS">

    For Azure Kubernetes Service (AKS), you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: aks
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: ingest.{region}.signoz.cloud:443
    otelInsecure: false
    signozApiKey: <SIGNOZ_INGESTION_KEY>
    presets:
      resourceDetection:
        detectors:
          - azure
          - system
    ```

  </TabItem>
</Tabs>

Depending on the choice of your region for SigNoz cloud, the ingestion endpoint will vary according to this table.

| Region	| Endpoint |
| --- | --- |
| US | ingest.us.signoz.cloud:443 |
| IN | ingest.in.signoz.cloud:443 |
| EU | ingest.eu.signoz.cloud:443 |

<Admonition>
- Replace `<SIGNOZ_INGESTION_KEY>` with the one provided by SigNoz.
- Replace `<CLUSTER_NAME>` with the name of the Kubernetes cluster or a unique identifier of the
  cluster.
- Replace `<DEPLOYMENT_ENVIRONMENT>` with the deployment environment of your application.
  Example: "staging", "production", etc.
</Admonition>

To install the `k8s-infra` chart with the above configuration, run the following command:

```bash
helm install my-release signoz/k8s-infra -f override-values.yaml
```

</TabItem>
<TabItem value="self-host" label="Self-Host">

<Admonition type="info">
By default, SigNoz Helm chart installs `k8s-infra` dependency chart which
handles the task of collecting metrics and logs from the Kubernetes cluster.

If you have single Kubernetes cluster for SigNoz and your applications,
you need not install `k8s-infra` chart.
</Admonition>



### Install K8s-Infra chart

To add the SigNoz Helm repository to your helm client, run the following command:

```bash
helm repo add signoz https://charts.signoz.io
```

If the chart is already present, update the chart to the latest version:

```bash
helm repo update
```

<Tabs groupId="k8s-vendor">
  <TabItem value="generic" label="Generic" default>

    For generic Kubernetes clusters, you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: others
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: <IP-or-Endpoint-of-SigNoz-OtelCollector>:4317
    otelInsecure: true
    ```

  </TabItem>
  <TabItem value="eks" label="AWS EKS">

    For AWS Elastic Kubernetes Service (EKS), you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: aws
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: <IP-or-Endpoint-of-SigNoz-OtelCollector>:4317
    otelInsecure: true
    presets:
      resourceDetection:
        detectors:
          - aws
          - system
    ```

  </TabItem>
  <TabItem value="gke" label="GKE (Standard)">

    For Google Kubernetes Engine (GKE) Standard, you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: gcp
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: <IP-or-Endpoint-of-SigNoz-OtelCollector>:4317
    otelInsecure: true
    presets:
      resourceDetection:
        detectors:
          - gcp
          - system
    ```

  </TabItem>
  <TabItem value="gke-autopilot" label="GKE (Autopilot)">

    For Google Kubernetes Engine (GKE) Autopilot, you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: gcp/autogke
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: <IP-or-Endpoint-of-SigNoz-OtelCollector>:4317
    otelInsecure: true
    presets:
      kubeletMetrics:
        authType: none
        endpoint: ${K8S_NODE_NAME}:10255
      resourceDetection:
        detectors:
          - gcp
          - system
    ```

  </TabItem>
  <TabItem value="aks" label="AKS">

    For Azure Kubernetes Service (AKS), you can use the following configuration:

    _override-values.yaml_

    ```yaml
    global:
      cloud: aks
      clusterName: <CLUSTER_NAME>
      deploymentEnvironment: <DEPLOYMENT_ENVIRONMENT>
    otelCollectorEndpoint: <IP-or-Endpoint-of-SigNoz-OtelCollector>:4317
    otelInsecure: true
    presets:
      resourceDetection:
        detectors:
          - azure
          - system
    ```

  </TabItem>
</Tabs>

<Admonition>
- Replace `<CLUSTER_NAME>` with the name of the Kubernetes cluster or a unique
  identifier of the cluster.
- Replace `<DEPLOYMENT_ENVIRONMENT>` with the deployment environment of your application.
  Example: "staging", "production", etc.
- If the OtelCollector endpoint is secured, you would have to disable `otelInsecure`
  configuration and often make other changes such as including either config
  or path to the TLS certificate and private key.
</Admonition>

To install the `k8s-infra` chart, run the following command:

```bash
helm install my-release signoz/k8s-infra  \
--set otelCollectorEndpoint=<IP-or-Endpoint-of-SigNoz-OtelCollector>:4317
```

</TabItem>
</Tabs>

## Send Data from Instrumented Applications

<figure data-zoomable align='center'>
    <img src="/img/docs/data-flow-2x.webp" alt="Data flow from your application to SigNoz"/>
    <figcaption>
      <i>
        OpenTelemetry instrumented application sends data to OTelAgent Daemon deployed in
        your k8s infra. The OTelAgent daemon sends the collected data to SigNoz.
      </i>
    </figcaption>
</figure>

<Admonition>
In case of **GKE Autopilot**, you will not be able to send data to OTelAgent Daemon
via host port. You will need to use either the SigNoz ingestion endpoint directly
or OtelAgent service name.

For OtelAgent service name, the endpoint would be something like
`my-release-k8s-infra-otel-agent.default.svc:4317`. Replace `my-release` with
your helm release name and `default` with your namespace.
</Admonition>

To send data from your applications, you must first instrument it with OpenTelemetry.
You can find instrumentation instructions for your specific language [here][10]. 

Once you're done instrumenting your application, add below to your application manifest
files for applications to start sending data to the otel-collectors running as DaemonSet.

For example, you can add the below config to your application manifest file.

```YAML
env:
  - name: HOST_IP
    valueFrom:
      fieldRef:
        fieldPath: status.hostIP
  - name: K8S_POD_IP
    valueFrom:
      fieldRef:
        apiVersion: v1
        fieldPath: status.podIP
  - name: K8S_POD_UID
    valueFrom:
      fieldRef:
        fieldPath: metadata.uid
  - name: OTEL_EXPORTER_OTLP_INSECURE
    value: "true"
  - name: OTEL_EXPORTER_OTLP_ENDPOINT
    value: $(HOST_IP):4317
  - name: OTEL_RESOURCE_ATTRIBUTES
    value: service.name=APPLICATION_NAME,k8s.pod.ip=$(K8S_POD_IP),k8s.pod.uid=$(K8S_POD_UID)
  ```
  
<Admonition>
  - Replace `APPLICATION_NAME` with your application name that you wish to see in SigNoz.
  - In cases of some SDKs, you would need to include `http://` or `https://` prefix for `OTEL_EXPORTER_OTLP_ENDPOINT`
  - You can also include `deployment.environment` as an attribute in `OTEL_RESOURCE_ATTRIBUTES` environment variable.
    This attribute will take precedence over `global.deploymentEnvironment` configuration of `k8s-infra` chart.
</Admonition>

### Disable Logs Collection

In case you do not want to collect logs from your Kubernetes cluster, you
can disable using presets in `k8s-infra` chart.

```yaml
presets:
  logsCollection:
    enabled: false
```

### Disable Metrics Collection

In case you do not want to collect metrics from your Kubernetes cluster, you
can disable using presets in `k8s-infra` chart.

```yaml
presets:
  hostMetrics:
    enabled: false
  kubeletMetrics:
    enabled: false
  clusterMetrics:
    enabled: false

otelDeployment:
  enabled: false
```

---

## Plot Metrics in SigNoz UI

To plot metrics generated from `k8s-infra` chart, follow the instructions given in the docs [here][4].

Check out the [List of metrics from Kubernetes receiver][3].

Here are some examples of metrics dashboard.

1. **Import Dashboard with PVC Metrics**

   You can import dashboard with PVC metrics of Kubernetes cluster
   from [here][5].

2. **Import Dashboard with Overall Kubernetes pods Metrics**

   You can import dashboard with the general Kubernetes pods metrics of your K8s cluster from [here][6].

3. **Import Dashboard with Detailed Kubernetes pods Metrics**

   You can import dashboard with more detailed granular Kubernetes pods metrics of your K8s cluster from [here][7].

4. **Import Dashboard with Overall Kubernetes Node Metrics**

   You can import dashboard with the general Kubernetes node metrics of your K8s cluster from [here][8].

5. **Import Dashboard with Detailed Kubernetes Node Metrics**

   You can import dashboard with more detailed granular Kubernetes node metrics of your K8s cluster from [here][9].

In the Dashboard page of SigNoz UI, you can create your own widgets as per you
need using metrics from the [list below][3].

---

## List of metrics

<K8sMetrics />

<HostMetrics name="Node Hostmetrics"/>

---

[1]: https://github.com/SigNoz/otel-collector-k8s/blob/main/agent/infra-metrics.yaml#L47
[2]: https://github.com/SigNoz/otel-collector-k8s/blob/main/deployment/all-in-one.yaml#L19
[3]: #list-of-metrics
[4]: https://signoz.io/docs/userguide/dashboards/
[5]: https://github.com/SigNoz/dashboards/blob/main/k8s-infra-metrics/kubernetes-pvc-metrics.json
[6]: https://github.com/SigNoz/dashboards/blob/main/k8s-infra-metrics/kubernetes-pod-metrics-overall.json
[7]: https://github.com/SigNoz/dashboards/blob/main/k8s-infra-metrics/kubernetes-pod-metrics-detailed.json
[8]: https://github.com/SigNoz/dashboards/blob/main/k8s-infra-metrics/kubernetes-node-metrics-overall.json
[9]: https://github.com/SigNoz/dashboards/blob/main/k8s-infra-metrics/kubernetes-node-metrics-detailed.json
[10]: https://signoz.io/docs/instrumentation/
