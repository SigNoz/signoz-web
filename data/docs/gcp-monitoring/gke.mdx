---
date: 2024-07-30
id: gke
title: GKE Metrics and Logging
---

## Overview

GKE (Google Kubernetes Engine) is a managed Kubernetes service provided by Google that simplifies the deployment, management, and operation of Kubernetes clusters. By using this documentation, you can send the metrics and logs of the GKE cluster to SigNoz.

<Tabs>
<TabItem value="cloud" label="SigNoz Cloud" default>

## Prerequisites

* [GKE cluster](https://cloud.google.com/kubernetes-engine) 
* Install [`kubectl`](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/) to access the GKE cluster.
* [Install Helm](https://helm.sh/docs/intro/install/)
* [SigNoz Cloud Account](https://signoz.io/teams/) (we are using SigNoz Cloud for this demonstration, we will also need ingestion details. To get your **Ingestion Key** and **Ingestion URL,** sign in to your SigNoz Cloud Account and go to **Settings** >> **Ingestion Settings**)

## Quick Start

First, we need to check if `helm` and `kubectl` tools are installed. Use these commands to verify: 

* `helm` version

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/helm-version.webp"
        alt="Helm version"
    />
<figcaption>
<i>
Helm version
</i>
</figcaption>
</figure>

* `kubectl` version


<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/kubectl-version.webp"
        alt="kubectl version"
    />
<figcaption>
<i>
`kubectl` version
</i>
</figcaption>
</figure>

Then, check the GKE cluster status:

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/gke-cluster-status.webp"
        alt="GKE cluster status"
    />
<figcaption>
<i>
GKE cluster status
</i>
</figcaption>
</figure>

**Step 1:** Now you can add SigNoz helm repo using this command

```sh
helm repo add SigNoz https://charts.signoz.io
```

**Step 2:** Install Otel collector using Helm chat 

```sh
helm install -n signoz  --create-namespace kubelet-otel signoz/k8s-infra \
--set signozApiKey=INGESTION_KEY_HERE --set otelCollectorEndpoint="ingest.<REGION>.signoz.cloud:443" --set otelInsecure=false
```

After, applying the above commands, check whether the SigNoz namespace pods are running successfully or not:

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/k8s-resources-cloud.webp"
        alt="Resources status"
    />
<figcaption>
<i>
Resources status
</i>
</figcaption>
</figure>

If running, it should start sending logs and metrics to SigNoz.

Check the logs of the OTel agent and deployment pods, to ensure the OTel agent is running:

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/otel-agent-logs-1.webp"
        alt="OTel agent and deployment pods logs"
    />
<figcaption>
<i>
OTel agent and deployment pods logs
</i>
</figcaption>
</figure>

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/otel-agent-logs-2.webp"
        alt="OTel agent and deployment pods logs"
    />
<figcaption>
<i>
OTel agent and deployment pods logs
</i>
</figcaption>
</figure>


Afterward, you could to create some pod to check to validate whether the logs and metrics are being sent successfully to SigNoz Cloud.

```sh
kubectl run -n signoz test –image=nginx –port=80
```

## Visualize the logs and metrics in Signoz Cloud

**To view logs**: 

Go to your SigNoz UI, and navigate to the SigNoz dashboard. Click on the Logs section to view the logs

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/visualize-logs.webp"
        alt="View logs in SigNoz dashboard"
    />
<figcaption>
<i>
View logs in SigNoz dashboard
</i>
</figcaption>
</figure>

**To view metrics**:

    1. Log in to your SigNoz cloud account.
    2. Navigate to the Dashboards, and add a dashboard
    3. Add a Timeseries Panel
    4. In Metrics, select any metric
    5. In Filter put name = mention service name 
    6. Hit “Save Changes”.
                                      
<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/k8s-metrics.webp"
        alt="Kubernetes cluster metrics"
    />
<figcaption>
<i>
Kubernetes cluster metrics
</i>
</figcaption>
</figure>

After saving changes, it should start showing collected metrics.

## Troubleshooting

If you encounter any issues while setting up logging and metrics for your GKE cluster, follow these troubleshooting steps:

1. Check the logs of the OpenTelemetry Collector:

    ```sh
    kubectl logs -f -n signoz -l app.kubernetes.io/component=otel-agent
    ```

    Review the logs for any error messages or indications of misconfiguration.

2. Verify the rendered configuration:

    ```sh
    kubectl get cm/kubelet-otel-k8s-infra-otel-agent -n signoz -o yaml
    ```

    Ensure the configuration matches your expected settings, including the SigNoz API key and the OpenTelemetry Collector endpoint.

3. Confirm that the necessary Kubernetes resources are created:

    ```sh
    kubectl get pods,services,configmaps -n signoz
    ```

    _Check if the required pods, services, and config maps are running and in a healthy state._

4. Verify network connectivity:

    * Ensure that the GKE cluster has network access to the SigNoz ingestion endpoint (`ingest.<region>.signoz.cloud:443`).
    * Check if there are any network security groups or firewalls blocking the required ports.

5. Double-check the SigNoz API key:

    * Confirm that the provided `signozApiKey` is correct and has the necessary permissions to ingest data.

</TabItem>

<TabItem value="self-host" label="Self-Host">

## Prerequisites

* GKE cluster 
* Install [`kubectl`](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/) to access the GKE cluster.
* [Install Helm](https://helm.sh/docs/intro/install/)
* [Self-Hosted Signoz in GKE Cluster](https://signoz.io/docs/install/kubernetes/gcp/) (If you are hosting SigNoz in Google Kubernetes Engine (GKE), you should refer to the specific guide that outlines the minimum requirements and provides details for the override-values.yaml ) OR if you're hosting SigNoz on VM, follow [self-hosted SigNoz on VM ](https://signoz.io/docs/install/docker/).

## Quick Start

First, we need to check if `helm` and `kubectl` tools are installed. Use these commands to verify: 

* `helm` version

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/helm-version.webp"
        alt="Helm version"
    />
<figcaption>
<i>
Helm version
</i>
</figcaption>
</figure>

* `kubectl` version

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/kubectl-version.webp"
        alt="kubectl version"
    />
<figcaption>
<i>
`kubectl` version
</i>
</figcaption>
</figure>

Then check the GKE cluster status:

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/gke-cluster-status.webp"
        alt="GKE cluster status"
    />
<figcaption>
<i>
GKE cluster status
</i>
</figcaption>
</figure>

**Step 1:** Now you can add SigNoz helm repo using this command

    ```sh
    helm repo add SigNoz https://charts.signoz.io
    ```

<Tabs>

<TabItem value="self-hosted-on-gke-cluster" label="For Self-hosted SigNoz in GKE Cluster" default>

**Step 2:** Install the OTel collector and SigNoz self-hosted using helm chart in GKE Cluster

    ```sh
    helm --namespace platform install my-release signoz/signoz -f override-values.yaml
    ```

</TabItem>

<TabItem value="self-host-signoz-in-vm" label="For Self-hosted SigNoz in a VM">

**Step 2:** Install the OTel Collector agent in GKE cluster where SigNoz is running in a self-hosted VM.

    ```sh
    helm install -n signoz  --create-namespace kubelet-otel signoz/k8s-infra \
    otelCollectorEndpoint="<self-hosted SigNoz VM IP>:4317" --set otelInsecure=true
    ```

</TabItem>
</Tabs>

After applying the above commands, check whether the pods are running successfully or not

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/k8s-resources-self-hosted.webp"
        alt="Resources status"
    />
<figcaption>
<i>
Resources status
</i>
</figcaption>
</figure>

If running, this should start sending logs and metrics to SigNoz.

Check the logs of the OTel agent and deployment pods :

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/otel-agent-logs-1.webp"
        alt="OTel agent and deployment pods logs"
    />
<figcaption>
<i>
OTel agent and deployment pods logs
</i>
</figcaption>
</figure>

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/otel-agent-logs-2.webp"
        alt="OTel agent and deployment pods logs"
    />
<figcaption>
<i>
OTel agent and deployment pods logs
</i>
</figcaption>
</figure>

After you need to create some pods to check the logs and metrics are sending successfully to SigNoz Cloud:

```sh
kubectl run -n signoz test –image=nginx –port=80
```

## Visualize the logs and metrics in Signoz Cloud

**To view logs**: 

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/visualize-logs.webp"
        alt="Visualize logs in SigNoz dashboard"
    />
<figcaption>
<i>
Visualize logs in SigNoz dashboard
</i>
</figcaption>
</figure>

Go to your SigNoz UI, and navigate to the SigNoz dashboard. Click on the Logs section to view the logs

**To view metrics**:

    1. Log in to your SigNoz cloud account.
    2. Navigate to the Dashboards, and add a dashboard
    3. Add a Timeseries Panel
    4. In Metrics, select any metric
    5. In Filter say name = mention service name 
    6. Hit “Save Changes”.

<figure data-zoomable align="left">
    <img
        src="/img/docs/gcp-monitoring/gke/k8s-metrics.webp"
        alt="Kubernetes cluster metrics"
    />
<figcaption>
<i>
Kubernetes cluster metrics
</i>
</figcaption>
</figure>


## Troubleshooting

If you encounter any issues while setting up logging and metrics for your GKE cluster, follow these troubleshooting steps:

<Tabs>
<TabItem value="self-hosted-on-gke-cluster" label="For Self-hosted SigNoz in GKE Cluster" default>

1. Confirm that the necessary Kubernetes resources are created:

    ```sh
    kubectl get pods,services,configmaps -n platform
    ```

    Check if the required pods, services, and config maps are running and in a healthy state.

</TabItem>
<TabItem value="self-host-signoz-in-vm" label="For Self-hosted SigNoz in a VM">

1. Check the logs of the OpenTelemetry Collector:

    ```sh
    kubectl logs -f -n signoz -l app.kubernetes.io/component=otel-agent
    ```
    
    Review the logs for any error messages or indications of misconfiguration.

2. Verify the rendered configuration:

    ```sh
    kubectl get cm/kubelet-otel-k8s-infra-otel-agent -n signoz -o yaml
    ```

    Ensure the configuration matches your expected settings, including the SigNoz API key and the OpenTelemetry Collector endpoint.

3. Confirm that the necessary Kubernetes resources are created:
    
    ```sh
    kubectl get pods,services,configmaps -n signoz
    ```

    *Check if the required pods, services, and config maps are running and in a healthy state.*

4. Verify network connectivity:
    
    * Ensure that the GKE cluster has network access to the SigNoz ingestion endpoint (`<Self-Hosted SigNoz VM IP:4317>`).
    * Check if there are any network security groups or firewalls blocking the required ports.

</TabItem>
</Tabs>


</TabItem>
</Tabs>
