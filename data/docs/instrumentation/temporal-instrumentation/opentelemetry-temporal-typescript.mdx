---
date: 2025-03-03
title: Instrument Temporal TypeScript Applications with OpenTelemetry
id: opentelemetry-temporal-typescript
description: Learn how to instrument Temporal TypeScript applications to send traces, metrics and logs to SigNoz using OpenTelemetry
---

### Step 1: Add OpenTelemetry Dependencies

Add the following dependencies to your `package.json`:

```json
"dependencies": {
    "@opentelemetry/api-logs": "^0.200.0",
    "@opentelemetry/auto-instrumentations-node": "^0.55.0",
    "@opentelemetry/exporter-logs-otlp-grpc": "^0.200.0",
    "@opentelemetry/sdk-logs": "^0.57.2",
    "@opentelemetry/sdk-node": "^0.57.0",
    "@opentelemetry/sdk-trace-node": "^1.30.0",
    "@temporalio/interceptors-opentelemetry": "^1.11.6"
}
```

### Step 2: Configure OpenTelemetry SDK

Create `src/instrumentation.ts` to configure the OpenTelemetry SDK and initialize tracing and metrics for your Temporal application:
```typescript:src/instrumentation.ts
import { NodeSDK } from '@opentelemetry/sdk-node';
import { SpanExporter } from '@opentelemetry/sdk-trace-node';
import { OTLPTraceExporter as OTLPTraceExporterGrpc } from '@opentelemetry/exporter-trace-otlp-grpc';
import { OTLPMetricExporter as OTLPMetricExporterGrpc } from '@opentelemetry/exporter-metrics-otlp-grpc';
import { OTLPLogExporter } from '@opentelemetry/exporter-logs-otlp-grpc';
import { SimpleLogRecordProcessor } from '@opentelemetry/sdk-logs';
import { PeriodicExportingMetricReader } from '@opentelemetry/sdk-metrics';
import { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';
import { Resource } from '@opentelemetry/resources';
import { logs } from '@opentelemetry/api-logs';
import { LoggerProvider } from '@opentelemetry/sdk-logs';

// Default OpenTelemetry endpoint for SigNoz cloud
// Available regions:
// - US: ingest.us.signoz.cloud:443
// - EU: ingest.eu.signoz.cloud:443
// - IN: ingest.in.signoz.cloud:443
const OTEL_EXPORTER_OTLP_ENDPOINT = process.env.OTEL_EXPORTER_OTLP_ENDPOINT || 'https://ingest.in.signoz.cloud:443';
const OTEL_RESOURCE_ATTRIBUTES = process.env.OTEL_RESOURCE_ATTRIBUTES || 'service.name=temporal-hello-world';

function extractKeyValues(str: string, delimiter = ',', keyValueSeparator = '='): { [key: string]: string } {
  if (!str) return {};

  const result: { [key: string]: string } = {};
  for (const pair of str.split(delimiter)) {
    const [key, value] = pair.split(keyValueSeparator);
    if (key && value) {
      result[key.trim()] = value.trim();
    }
  }
  return result;
}

const resourceAttributes = extractKeyValues(OTEL_RESOURCE_ATTRIBUTES);

const headers = process.env.OTEL_EXPORTER_OTLP_HEADERS
  ? extractKeyValues(process.env.OTEL_EXPORTER_OTLP_HEADERS)
  : undefined;

function setupTraceExporter(): SpanExporter | undefined {
  console.log('[Instrumentation] Setting up Trace Exporter to', OTEL_EXPORTER_OTLP_ENDPOINT);
  return new OTLPTraceExporterGrpc({
    url: OTEL_EXPORTER_OTLP_ENDPOINT,
    timeoutMillis: 1000,
    headers
  });
}

function setupMetricReader() {
  console.log('[Instrumentation] Setting up Metric Reader to', OTEL_EXPORTER_OTLP_ENDPOINT);
  return new PeriodicExportingMetricReader({
    exporter: new OTLPMetricExporterGrpc({
      url: OTEL_EXPORTER_OTLP_ENDPOINT,
      timeoutMillis: 1000,
      headers
    }),
  });
}

function setupLogExporter() {
  console.log('[Instrumentation] Setting up Log Exporter to', OTEL_EXPORTER_OTLP_ENDPOINT);
  return new OTLPLogExporter({
    url: OTEL_EXPORTER_OTLP_ENDPOINT,
    timeoutMillis: 1000,
    headers
  });
}

export const resource = new Resource(resourceAttributes);

export const traceExporter = setupTraceExporter();
const metricReader = setupMetricReader();
const logExporter = setupLogExporter();

const loggerProvider = new LoggerProvider({ resource });
loggerProvider.addLogRecordProcessor(new SimpleLogRecordProcessor(logExporter));
logs.setGlobalLoggerProvider(loggerProvider);

export const otelSdk = new NodeSDK({
  resource,
  traceExporter,
  metricReader,
  instrumentations: [getNodeAutoInstrumentations()],
});

otelSdk.start();
```

### Step 3: Add OpenTelemetry Interceptor

To instrument your Temporal client, make the following changes to your `client.ts` file:

```typescript:src/client.ts
import { OpenTelemetryWorkflowClientInterceptor } from '@temporalio/interceptors-opentelemetry';
import { logs } from '@opentelemetry/api-logs';

const logger = logs.getLogger('client');

logger.emit({ body: 'Creating Temporal client...' });

// ...

const client = new Client({
  // ... other client config ...
  interceptors: {
    workflow: [new OpenTelemetryWorkflowClientInterceptor()],
  },
});
```

This interceptor enables workflow tracing while the logger provides correlated structured logs.

### Step 4: Configure Temporal Worker

Add OpenTelemetry instrumentation to your worker:

```typescript:src/worker.ts
import { Runtime } from '@temporalio/worker';
import {
  OpenTelemetryActivityInboundInterceptor,
  OpenTelemetryActivityOutboundInterceptor,
  makeWorkflowExporter,
} from '@temporalio/interceptors-opentelemetry/lib/worker';
import { otelSdk, resource, traceExporter } from './instrumentation';
import { logs } from '@opentelemetry/api-logs';

const logger = logs.getLogger('worker');

function initializeRuntime() {
  Runtime.install({
    telemetryOptions: {
      metrics: {
        otel: {
          // Default OpenTelemetry endpoint for SigNoz cloud
          // Available regions:
          // - US: ingest.us.signoz.cloud:443
          // - EU: ingest.eu.signoz.cloud:443
          // - IN: ingest.in.signoz.cloud:443
          url: process.env.OTEL_EXPORTER_OTLP_ENDPOINT || 'https://ingest.in.signoz.cloud:443',
          metricsExportInterval: '10s'
        }
      },
    },
  });
}

async function run() {
  initializeRuntime();

  try {
    logger.emit({ body: 'Connecting to Temporal server' });
    
    worker = await Worker.create({
      // ... other worker config ...
      sinks: traceExporter && {
        exporter: makeWorkflowExporter(traceExporter, resource),
      },
      interceptors: traceExporter && {
        workflowModules: [require.resolve('./workflows')],
        activity: [
          (ctx) => ({
            inbound: new OpenTelemetryActivityInboundInterceptor(ctx),
            outbound: new OpenTelemetryActivityOutboundInterceptor(ctx),
          }),
        ],
      },
    });
  } catch (err) {
    logger.emit({ body: `Error running worker: ${err}`, severityText: 'ERROR' });
    // ... error handling ...
  } finally {
    await otelSdk.shutdown();
  }
}
```

This configuration enables OpenTelemetry instrumentation for both workflow and activity telemetry in your Temporal worker.

### Step 5: Configure Temporal Workflow

Add OpenTelemetry interceptors to your workflow code:

```typescript:src/workflows.ts
import { log, WorkflowInterceptorsFactory } from '@temporalio/workflow';
import {
  OpenTelemetryInboundInterceptor,
  OpenTelemetryOutboundInterceptor,
  OpenTelemetryInternalsInterceptor,
} from '@temporalio/interceptors-opentelemetry/lib/workflow';

export async function greetUser(name: string): Promise<string> {
  log.info('Starting workflow execution', { name });
  // ... workflow logic ...
}

// ... other workflow config ...
export const interceptors: WorkflowInterceptorsFactory = () => ({
  inbound: [new OpenTelemetryInboundInterceptor()],
  outbound: [new OpenTelemetryOutboundInterceptor()],
  internals: [new OpenTelemetryInternalsInterceptor()],
});
```

These interceptors enable telemetry collection for inbound signals, outbound activities, and internal workflow operations.